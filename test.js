$(function() {
	var imgs=[ // {
		[76,75,75,76,76,76,79,79,79,69,66,61,56,53,51,51,49,49,48,48,48,48,48,49,53,51,49,48,48,49,49,51,51,51,51,48,47,46,47,48,48,49,49,48,47,44,43,43,41,43,44,44,43,43,44,46,48,47,47,44,45,45,45,47,48,48,48,43,41,41,43,43,44,44,43,43,41,45,45,45,45,45,46,47,48,52,55,58,48,41,39,39,41,42,46,49,48,48,49,47,43,39,40,42,42,42,43,43,45,44,40,37,37,37,38,38,39,40,44,46,47,47,47,47,46,47,47,47,47,47,46,46,45,44,42,41,41,42,44,45,45,45,45,45,45,45,44,44,44,44,44,42,42,41,41,39,40,40,41,41,41,40,40,40,40,40,40,40,40,40,40,40,40,41,41,39,39,38,37,37,37,38,38,38,35,37,37,37,35,35,35,35,35,35,37,37,38,39,39,40,39,39,39,38,38,37,38,38,38,37,37,37,37,37,37,35,36,36,36,36,36,36,37,37,40,40,40,40,40,41,42,43,44,45,45,45,45,42,49,59,61,60,56,55,54,55,63,70,104,146,207,217,224,226,228,228,228,229,230,231,231,231,231,231,231,231,232,232,232,232,232,232,232,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,230,230,230,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,230,230,230,230,230,229,228,227,225,225,221,223,210,188,109,58,65,74,110,183,201,199,192,162,77,61,59,78,125,192,192,191,165,81,60,50,47,49,47,45,46,47,48,52,53,51,56,106,171,196,194,180,106,45,48,52,48,48,50,57,60,97,174,209,214,218,222,224,224,223,223,223,223,221,218,208,187,101,66,70,92,158,208,215,218,218,218,218,214,207,192,116,56,62,70,136,192,199,196,185,121,57,58,60,104,176,204,211,212,214,214,214,212,199,149,69,54,52,51,46,47,47,47,47,47,50,48,55,102,170,187,188,182,139,64,50,48,50,51,51,51,50,47,47,47,47,46,46,47,46,47,63,128,177,189,191,175,108,58,57,59,96,168,188,194,191,158,75,64,62,96,169,204,209,215,220,224,222,222,222,222,222,222,222,221,221,217,217,209,185,114,66,65,71,133,196,207,214,220,221,222,220,220,217,216,216,211,204,173,93,64,52,52,49,48,51,52,83,149,188,192,186,160,90,59,56,62,128,181,192,191,177,120,57,56,58,101,163,191,194,185,149,89,58,56,66,136,183,191,192,159,85,54,54,53,128,177,189,192,178,112,57,47,48,47,46,46,46,45,45,45,44,47,82,156,192,201,207,209,210,210,205,203,152,87,56,54,73,148,182,187,188,158,94,60,46,44,43,43,43,43,44,45,45,45,49,98,169,202,209,216,214,213,211,206,190,121,77,63,63,141,188,202,210,209,210,213,214,208,194,131,74,64,59,145,190,206,213,216,218,217,217,217,216,214,213,213,204,161,100,64,54,64,138,180,192,194,173,115,75,60,60,130,187,204,212,214,215,218,219,219,220,220,219,218,216,217,215,216,214,202,141,83,67,65,94,168,198,201,208,207,207,212,207,191,134,83,60,45,42,44,41,41,41,41,42,42,36,51,132,170,184,188,165,106,65,53,47,42,39,41,40,41,42,44,41,36,85,159,184,191,191,140,91,64,56,66,151,189,203,207,214,215,217,210,201,164,104,65,57,64,141,181,192,196,168,110,76,61,52,122,181,201,209,214,214,218,220,220,221,221,221,221,221,221,221,221,221,221,221,221,221,220,220,220,219,218,218,217,215,216,216,202,145,98,75,59,94,161,185,193,190,141,100,64,55,51,49,49,45,45,101,171,193,199,208,209,210,205,205,186,124,98,73,57,92,166,181,193,186,137,91,73,62,52,47,43,43,42,42,41,44,36,52,133,169,181,183,166,115,86,68,52,116,169,178,185,177,128,91,69,62,103,166,188,198,208,214,215,214,211,190,126,97,78,64,47,42,40,41,40,42,40,38,39,103,160,177,185,175,126,92,69,63,117,170,190,200,210,209,210,211,209,190,149,110,91,77,63,50,46,45,93,157,176,192,206,206,209,212,210,194,151,113,91,97,142,166,176,180,152,111,93,80,93,149,170,193,200,205,210,211,213,213,213,214,214,197,162,122,105,85,68,60,48,40,92,138,164,167,166,125,103,87,81,119,152,162,171,150,118,102,80,95,145,176,185,196,199,206,209,210,209,207,207,199,181,148,124,97,80,76,65,53,58,114,149,164,166,140,113,97,93,119,153,173,185,193,202,207,212,213,214,215,216,216,216,215,215,215,214,213,213,213,213,213,213,214,214,215,215,215,215,214,213,212,211,210,210,208,206,194,166,138,116,103,82,65,55,46,41,37,34,32,30,30,29,28,28,28,28,28,28,27,27,27,26,26,26,25,25,25,26,26,26,26],
		[35,33,38,42,40,40,36,36,31,27,28,29,31,35,42,38,34,32,28,29,29,32,33,33,33,33,34,35,32,32,33,36,33,32,30,32,34,34,32,38,48,46,44,69,69,46,39,48,44,33,29,27,27,29,29,29,28,28,26,23,27,28,34,30,29,29,29,29,29,29,28,29,30,32,30,30,31,29,29,29,29,29,27,26,25,25,26,26,27,27,27,27,26,26,26,28,28,28,27,28,30,33,32,29,26,26,26,28,26,26,26,24,22,22,25,25,25,26,25,31,29,33,33,41,33,24,24,26,25,26,27,27,28,29,29,29,27,25,28,29,29,29,29,33,33,32,27,24,23,22,22,23,26,28,28,28,28,29,29,28,28,28,28,28,29,29,29,28,27,26,26,27,29,30,30,27,31,33,32,31,30,30,27,27,28,28,28,27,26,26,28,29,30,29,29,28,28,28,27,27,27,27,27,28,28,29,31,31,29,28,28,27,27,28,29,33,31,28,27,26,26,26,26,28,27,24,24,25,27,27,25,25,25,24,24,24,24,24,24,23,22,22,22,22,23,23,23,24,23,24,23,23,23,23,24,24,25,26,26,26,26,25,25,26,27,31,36,38,37,37,37,37,43,38,36,93,176,217,225,227,227,229,230,231,232,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,232,233,233,233,233,233,233,233,233,233,233,233,233,233,232,232,232,232,232,233,233,233,233,233,233,233,233,233,233,233,233,232,232,232,232,232,232,232,230,230,229,229,227,229,224,214,160,55,41,41,86,180,206,205,201,130,35,37,34,96,184,195,195,163,57,32,31,33,32,29,29,29,30,32,32,27,39,122,198,201,204,127,27,29,34,35,34,36,36,43,135,209,223,223,223,225,227,227,227,225,227,223,219,197,87,42,46,89,188,214,222,221,222,221,221,214,186,73,38,35,87,183,206,207,195,97,32,37,36,133,209,211,214,217,216,221,222,206,97,26,36,39,33,29,30,30,30,30,27,25,53,158,194,194,194,108,21,28,29,27,30,30,30,30,29,28,28,27,26,27,23,28,109,190,196,196,159,51,34,34,55,168,199,199,201,121,32,38,34,143,211,218,221,221,226,225,225,225,225,225,225,225,221,220,220,219,141,39,41,34,112,212,213,220,222,224,225,223,222,220,220,215,213,127,34,31,28,31,34,33,28,77,185,197,196,187,76,34,34,38,147,203,201,206,135,35,38,36,87,194,200,201,179,63,35,33,34,151,203,200,193,83,34,37,32,125,202,201,201,147,31,30,31,31,28,28,29,29,26,27,22,46,173,209,212,216,218,216,218,216,129,31,33,27,90,195,197,195,161,42,26,27,30,29,29,29,27,29,30,29,26,151,214,216,217,220,218,214,214,155,46,43,29,140,212,215,220,218,218,222,220,195,78,35,35,69,195,215,219,220,222,222,221,221,221,220,215,214,141,38,36,25,96,200,203,204,161,50,42,32,75,196,213,218,219,223,225,224,224,223,223,222,221,221,219,219,225,135,34,50,34,122,207,212,215,215,216,216,209,178,55,29,27,26,26,25,24,24,24,24,15,31,159,192,193,197,90,24,24,27,25,24,24,24,26,24,21,16,112,200,193,202,139,40,33,24,98,196,209,218,221,221,221,211,180,70,35,32,49,169,197,199,194,86,34,35,29,168,209,216,222,220,222,222,223,225,225,226,226,226,226,226,226,226,226,226,226,225,224,222,221,219,215,215,211,186,89,43,30,77,177,199,200,165,64,33,29,27,28,24,21,57,173,207,210,213,211,209,208,190,99,37,35,37,156,195,199,198,101,35,40,36,30,28,26,25,25,25,23,23,131,194,201,199,118,45,37,24,127,196,199,199,133,53,33,29,133,203,212,221,217,217,217,213,142,62,41,34,25,21,20,20,23,23,17,21,130,184,185,191,116,59,42,38,156,210,213,212,210,209,206,209,143,56,41,37,29,29,24,48,167,202,209,213,214,217,214,185,106,56,36,93,181,191,198,140,66,43,26,135,194,205,214,216,219,220,218,217,216,211,177,93,55,42,30,25,18,18,136,187,195,186,101,58,39,70,163,192,200,143,82,52,38,146,199,207,211,213,217,217,215,215,214,207,145,81,49,41,33,31,16,78,168,187,183,114,65,54,83,177,197,206,210,215,219,218,219,221,221,221,221,221,221,221,220,220,220,220,220,220,220,220,219,218,215,215,214,214,215,217,213,204,144,89,61,47,32,29,21,20,19,18,17,17,15,15,15,16,17,18,18,18,18,18,18,18,19,19,20,20,20,20,20,20,21,21,21,21,21,21,21,20,20,19,17,15,15,13,13,13,13,12,11,9,6,5,4,4,4,4,4,4,3,2,1,1,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
	]; // }
	$('button').click(function() {
		var kbarcode=new Worker('kbarcode.js');
		$('button').remove();
		var cur=-1;
		function next() {
			cur++;
			var $preview=$('#preview').css({'position':'relative', 'padding-top':'10px'}).empty(), width;
			function resultCallback(result) {
				result=result.data;
				console.log(result);
				if (result.value) {
					alert(value);
				}
				if (result.left) {
					$('<div class="marker" style="left:'+result.left+'px;width:'+(result.bitsize*result.quietSize)+'px"/>').appendTo($preview);
				}
				if (result.right) {
					$('<div class="marker" style="left:'+result.right+'px;width:'+(result.bitsize*result.quietSize)+'px;background:red"/>').appendTo($preview);
				}
				if (result.leftMarker) {
					$('<div class="marker" style="left:'+result.leftMarker[0]+'px;width:'+(result.bitsize)+'px;background:blue"/>').appendTo($preview);
					$('<div class="marker" style="left:'+result.leftMarker[1]+'px;width:'+(result.bitsize)+'px"/>').appendTo($preview);
					$('<div class="marker" style="left:'+result.leftMarker[2]+'px;width:'+(result.bitsize)+'px;background:blue"/>').appendTo($preview);
				}
				if (result.middleMarker) {
					$('<div class="marker" style="left:'+result.middleMarker[0]+'px;width:'+(result.bitsize)+'px;background:blue"/>').appendTo($preview);
					$('<div class="marker" style="left:'+result.middleMarker[1]+'px;width:'+(result.bitsize)+'px"/>').appendTo($preview);
					$('<div class="marker" style="left:'+result.middleMarker[2]+'px;width:'+(result.bitsize)+'px;background:blue"/>').appendTo($preview);
					$('<div class="marker" style="left:'+result.middleMarker[3]+'px;width:'+(result.bitsize)+'px"/>').appendTo($preview);
					$('<div class="marker" style="left:'+result.middleMarker[4]+'px;width:'+(result.bitsize)+'px;background:blue"/>').appendTo($preview);
				}
				if (result.rightMarker) {
					$('<div class="marker" style="left:'+result.rightMarker[0]+'px;width:'+(result.bitsize)+'px;background:blue"/>').appendTo($preview);
					$('<div class="marker" style="left:'+result.rightMarker[1]+'px;width:'+(result.bitsize)+'px"/>').appendTo($preview);
					$('<div class="marker" style="left:'+result.rightMarker[2]+'px;width:'+(result.bitsize)+'px;background:blue"/>').appendTo($preview);
				}
				if (result.lbytes) {
					var lbytes=result.lbytes;
					for (var i=0;i<lbytes.length;i++) {
						var bits=lbytes[i].split('');
						for (var j=0;j<bits.length;++j) {
							$('<div class="marker" style="left:'+(result.bcStart+result.bitsize*(i*7+j+3))+'px;width:'+(result.bitsize)+'px;background:'+(bits[j]=='1'?'black':'white')+'"/>').appendTo($preview);
						}
					}
				}
				if (result.rbytes) {
					var rbytes=result.rbytes;
					for (var i=0;i<rbytes.length;i++) {
						var bits=rbytes[i].split('');
						for (var j=0;j<bits.length;++j) {
							$('<div class="marker" style="left:'+(result.bcStart+result.bitsize*(i*7+j+8+6*7))+'px;width:'+(result.bitsize)+'px;background:'+(bits[j]=='1'?'black':'white')+'"/>').appendTo($preview);
						}
					}
				}
			}
			kbarcode.addEventListener('message', resultCallback);
			for (var i=0;i<imgs[cur].length;++i) {
				var p=imgs[cur][i];
				$('<div title="'+i+'" style="position:absolute;left:'+i+'px;top:0;height:100px;width:1px;background:rgb('+p+', '+p+', '+p+');"/>').appendTo($preview);
			}
			width=imgs[cur].length;
			kbarcode.postMessage({
				'cmd':'decode',
				'msg':imgs[cur]
			});
			return;
		}
		next();
	}).click();
});
